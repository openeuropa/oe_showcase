# OpenEuropa Showcase Glossary

This module provides an example of a glossary taxonomy vocabulary and a page that shows the glossary terms, organised by
first character.

The glossary page, accessible at `/glossary`, shows a summary with all the first characters for the terms created in the
glossary vocabulary. Clicking one of the characters will show only the terms that start with said character.\
Additionally:
- When the glossary page is accessed without any character selection, the first character available in the summary is
  automatically activated;
- The summary entries are sorted so that numbers are shown after letters;
- Fallback sort, additionally to the one selected in the interface;
- Diacritics are removed from the summary characters;
- Active filter and results count are shown in the title.

## Requirements

Aside from Drupal core Taxonomy and Views modules, it has the following dependencies:

- [OpenEuropa Bootstrap Theme](https://github.com/openeuropa/oe_bootstrap_theme): Provides the patterns and
styling for the glossary summary and results.
- [Better Exposed Filters](https://www.drupal.org/project/better_exposed_filters): Optional. Provides
auto-submit for the sort and page size form elements.

## How it was built

In the [config/install](./config/install) folder the following configuration:

- The "Glossary" taxonomy vocabulary ([`taxonomy.vocabulary.glossary.yml`](./config/install/taxonomy.vocabulary.glossary.yml));
- A "Teaser" view mode for taxonomy terms ([`core.entity_view_mode.taxonomy_term.teaser.yml`](./config/install/core.entity_view_mode.taxonomy_term.teaser.yml));
- Configured displays for "Full" and "Teaser" view modes ([`core.entity_view_display.taxonomy_term.glossary.full.yml`](./config/install/core.entity_view_display.taxonomy_term.glossary.full.yml)
and [`core.entity_view_display.taxonomy_term.glossary.teaser.yml`](./config/install/core.entity_view_display.taxonomy_term.glossary.teaser.yml));
- The glossary page, created with Views ([`views.view.glossary_page`](./config/install/views.view.glossary_page.yml)).

The view itself contains two displays:
- a page display (`page_1`) which renders the results of the view. It takes a character as argument and filters by it.
  The page is accessible at `/glossary`.
- an attachment display (`attachment_1`) renders the glossary summary, which consists of a list of all the characters the
  glossary taxonomy terms contains. The characters are automatically stripped of diacritics.

The templates are located in the Showcase theme:

- [taxonomy-term--glossary--full.html.twig](../../themes/oe_showcase_theme/templates/taxonomy/taxonomy-term--glossary--full.html.twig) and
  [taxonomy-term--glossary--teaser.html.twig](../../themes/oe_showcase_theme/templates/taxonomy/taxonomy-term--glossary--teaser.html.twig)
implement the styling for the glossary term view modes;
- [views-view--glossary-page--page-1.html.twig](../../themes/oe_showcase_theme/templates/views/views-view--glossary-page--page-1.html.twig)
styles the global elements of the glossary page;
- [views-view-summary--glossary-page--attachment-1.html.twig](../../themes/oe_showcase_theme/templates/views/views-view-summary--glossary-page--attachment-1.html.twig)
styles the summary part of the glossary page.

Extra taxonomy term template suggestions are necessary to style the teaser view mode. These suggestions are generated by
`oe_showcase_theme_theme_suggestions_taxonomy_term_alter()` in the [Showcase theme file](../../themes/oe_showcase_theme/oe_showcase_theme.theme).

Various hooks implementations are located in [`oe_showcase_glossary.module`](./oe_showcase_glossary.module) and
implemented in a dedicated class, [`GlossaryViewHooks`](./src/GlossaryViewHooks.php).

## How to install

1. Using composer, require `openeuropa/oe_bootstrap_theme` and `drupal/bef`.
2. Either one of:
   - copy the entire `oe_showcase_glossary` module directly
   - copy the files listed above, taking care of renaming the hooks of `oe_showcase_glossary.module` and
   the `GlossaryViewHooks` namespace.
3. Copy the templates listed above in your own theme.

## How to customise

### Adding new displays

New Views displays can be added to the glossary view, for example to be shown as block.\
The code in [`GlossaryViewHooks`](./src/GlossaryViewHooks.php) can be updated to take into account for the new displays.
Just update the [`::isPageDisplay()`](./src/GlossaryViewHooks.php#L72) and [`::isSummaryDisplay()`](./src/GlossaryViewHooks.php#L85)
to include the new display IDs.\
E.g. if adding a new block display `block_1`:
- edit the `attachment_1` view display to be attached to the new block display;
- update the `::isPageDisplay()` method to return TRUE also for the new display ID.
- style the needed view templates accordingly.

### Custom initial character

This glossary implementation will render all characters as dedicated entries in the summary, including special characters.
If you need a custom strategy for generating the initial character, you can do the following:

1. Add a new field of type string, max length 1 to the glossary term entity.
2. Update the view to use the new field as argument, instead of term name.
3. Either expose the field to editors in the term edit form (making it mandatory) or implement `hook_ENTITY_TYPE_presave()` to
update the value automatically upon save. For example, you can:
   - transliterate the first character to transform special characters like `Ã†` using `\Drupal::transliteration()->transliterate()`;
   - filter out special characters from the beginning of the term name, like `*, \`.

Please note that this functionality is not provided in this module.
